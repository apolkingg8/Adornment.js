{"version":3,"sources":["G:\\GitHub\\decorate_js\\src\\trace.jsx"],"names":[],"mappings":"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","file":"trace.js","sourcesContent":["import Helpers from './_helper'\r\n\r\nfunction _descriptorHandler(key, descriptor, input) {\r\n    var method = Helpers.getMethod(descriptor)\r\n    var {logger, blackList, whiteList, perf} = input\r\n\r\n    logger = logger || console.log.bind(console)\r\n    blackList = blackList || []\r\n    whiteList = whiteList || []\r\n\r\n    var _shouldLog = function() {\r\n        if(blackList.length > 0) return !(blackList.indexOf(key) > 0)\r\n        if(whiteList.length > 0) return (whiteList.indexOf(key) > 0)\r\n        return true\r\n    }\r\n\r\n    function setPerf() {\r\n        if(window.performance) {\r\n            return window.performance.now()\r\n        } else {\r\n            return new Date()\r\n        }\r\n    }\r\n\r\n    descriptor.value = function(...args) {\r\n\r\n        if(_shouldLog()) {\r\n            logger('@trace:', key, `with args:`, args, `this:`, this)\r\n\r\n            if(perf && !this._trace_perfStart) {\r\n                Object.defineProperty(this, '_trace_perfStart', {\r\n                    enumerable: false,\r\n                    writable: false,\r\n                    configurable: true,\r\n                    value: setPerf()\r\n                })\r\n            }\r\n        }\r\n\r\n        var temp = method.apply(this, args)\r\n\r\n        if(_shouldLog()) {\r\n\r\n            if(perf) {\r\n                var cost = setPerf() - this._trace_perfStart\r\n                delete this._trace_perfStart\r\n                logger('@trace:', key, `return`, temp, `cost ${cost} ms.`)\r\n            } else {\r\n                logger('@trace:', key, `return`, temp)\r\n            }\r\n        }\r\n\r\n        return temp\r\n    }\r\n\r\n    return descriptor\r\n}\r\n\r\nfunction handleClass(target: Function, input) {\r\n\r\n    Helpers.forEachClassOwnKeys(target, function(key) {\r\n\r\n        if(typeof target.prototype[key] === \"function\") {\r\n            var descriptor = Object.getOwnPropertyDescriptor(target.prototype, key)\r\n\r\n            descriptor = _descriptorHandler(key, descriptor, input)\r\n\r\n            Object.defineProperty(target.prototype, key, descriptor)\r\n        }\r\n    })\r\n\r\n    return target\r\n}\r\n\r\nfunction handleMethod(target: Function, key: String, descriptor, input) {\r\n\r\n    return _descriptorHandler(key, descriptor, input)\r\n}\r\n\r\nfunction handleProp(target: Function, key: String, descriptor, input) {\r\n    console.warn(`@trace should not set on class properties.`)\r\n    return descriptor\r\n}\r\n\r\nfunction trace(input = {}) {\r\n\r\n    var {logger, blackList, whiteList, perf} = input\r\n\r\n    if(typeof input !== \"object\") {\r\n        Helpers.wrongInput('trace', 'object', input)\r\n        return;\r\n    } else if((typeof logger !== \"function\") && (typeof logger !== \"undefined\")) {\r\n        console.warn(`@trace: Type Error, logger must be a function, not ${typeof logger}}`)\r\n        return;\r\n    } else if((typeof blackList !== \"undefined\") && (blackList.constructor !== Array)) {\r\n        console.warn(`@trace: Type Error, blackList must be a Array, not ${typeof blackList}}`)\r\n        return;\r\n    } else if((typeof whiteList !== \"undefined\") && (whiteList.constructor !== Array)) {\r\n        console.warn(`@trace: Type Error, whiteList must be a Array, not ${typeof whiteList}}`)\r\n        return;\r\n    } else if(blackList && whiteList) {\r\n        console.warn('@trace: You can not use both blackList and whiteList.')\r\n        return;\r\n    }\r\n\r\n    return function(...args) {\r\n        Helpers.handler(args, input, handleClass, handleMethod, handleProp)\r\n    }\r\n}\r\nexport default trace"]}